<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <title>Welcome to Firebrand</title> <link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAlUlEQVR42rXSwQmAMBQD0I7SkbpRV+gcHchzT47Qq0pAY0o/n4IKwUvzLMGQQzjuXE9I17sO6QjPvINC5gFEyh8CRH4BqgLMEqAFIh4wfj0pwsyAjALLAARZAGKMzzW3vY8I3mm6gQIIYYZlG0Cc9X2glOKsb48IoLXG29hlAlmWByJhwQSIVAVkxCnQUdR0RP4NEzoBfBT42XTc3E4AAAAASUVORK5CYII="> <style>body{font-family:Roboto,Arial,sans-serif;background:#ECEFF1 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAGUlEQVR42mI4c+bMfyBgYAQRZ8+e/Q8QYAB1SAzF+qrpogAAAABJRU5ErkJggg==");color:rgba(0,0,0,0.87)}a{color:#039be5}.message{max-width:400px;margin:40px auto;box-shadow:0 1px 3px 0 rgba(0,0,0,0.2),0 1px 1px 0 rgba(0,0,0,0.14),0 2px 1px -1px rgba(0,0,0,0.12);border-radius:2px;background:white;padding:16px 24px}.message h2{font-size:22px;font-weight:500;text-align:center;margin:0 0 16px}.message p{font-weight:300;line-height:150%}.message ul{list-style:none;margin:16px 0 0;padding:0;text-align:center}.message li a{display:inline-block;margin-bottom:5px;padding:8px;text-transform:uppercase;text-decoration:none;font-weight:500;background:#e50303;color:white;border:1px solid #039be5;border-radius:3px;font-size:14px;box-shadow:0 2px 5px 0 rgba(0,0,0,0.26)}.message .cache-status__install--false{background:#e50303}.message .cache-status__install--true{background:green}body{font-family:sans-serif}.dice{border:1px solid black;padding:5px;border-radius:2px;display:inline-block;margin:0 0 5px}.dice--pair{background-color:red}.dice--win{background-color:blue}.dice__die{display:inline-block;background:silver;margin:0 5px 5px 0;padding:5px;width:15px;font-weight:bold;border-radius:5px;text-align:center}.dice__die:last-child{margin-right:0}.roll{display:inline-block;margin:0 0 5px 0;padding:5px;text-decoration:none;font-weight:bold;color:black;background:salmon;border-radius:2px}</style> <script>class CACHE { constructor() { this.path = '/sw.js'; this.scope = '/'; this.currentCache = "v1"; this.cached = false; } checkCache() { caches.match('/').then(function (resp) { if (resp) { Cache.install_button.classList.add("cache-status__install--true"); Cache.install_button.textContent = "Cached"; Cache.cached = true; } else { Cache.install_button.classList.add("cache-status__install--false"); Cache.install_button.textContent = "Uncached"; Cache.cached = false; } }); } installCache() { const filesToCache = ['/']; caches.open(Cache.currentCache).then(function (cache) { console.log("SW: Installing initial cache"); cache.addAll(filesToCache); setTimeout(function () { location.reload(); }, 200); }); } deleteCache() { console.log('Trying to delete cache'); caches.open(Cache.currentCache).then(function (cache) { cache.delete('/').then(function (response) { console.log('Cache deleted'); setTimeout(function () { location.reload(); }, 200); }); }).catch(function (error) { console.log('Cache delete failed' + error); }); } cleanCache() { const cacheWhitelist = [currentCache]; caches.keys().then(function (keyList) { return Promise.all(keyList.map(function (key) { if (cacheWhitelist.indexOf(key) === -1) { return caches.delete(key); } })); }); } fetchCache() { event.respondWith(caches.match(event.request).then(function (resp) { if (resp) console.log("SW: Resource loaded from cache"); return resp || fetch(event.request).then(function (response) { console.log("SW: Requested resource not yet cached, caching now"); return caches.open(currentCache).then(function (cache) { cache.put(event.request, response.clone()); return response; }); }); })); } } class CEELO { constructor() { this.rollResults = ""; this.matches = ""; this.potentialPoints = ""; this.dice = ""; this.setPoint = ""; this.roll = ""; this.allDice = ""; } createDice(amount = 3) { for (let index = 0; index < amount; index++) { const dieDiv = document.createElement("div"); dieDiv.classList.add("dice__die"); dieDiv.classList.add("dice__die-" + (index + 1)); const placeholderContent = document.createTextNode("6"); dieDiv.appendChild(placeholderContent); CL.dice.appendChild(dieDiv); } } rollDice() { console.log("rolling dice"); let rollResults = []; Array.prototype.forEach.call(CL.allDice, function (die) { const rollResult = Math.floor(Math.random() * 6 + 1); die.textContent = rollResult; rollResults.push(rollResult); }); return rollResults; } findMatches() { let sortedRolls = CL.rollResults.slice().sort(); CL.potentialPoints = sortedRolls.slice(); let matches = []; for (let i = 0; i < CL.rollResults.length - 1; i++) { if (sortedRolls[i] == sortedRolls[i + 1]) { matches.push(sortedRolls[i]); CL.potentialPoints.splice(i, 2); } } return matches; } determineResults() { const rolledDoubles = CL.matches[0]; const rolledTriples = CL.matches[1]; if (rolledTriples) { CL.dice.classList.add("dice--win"); } else if (rolledDoubles) { const single = CL.potentialPoints[0]; CL.dice.classList.add("dice--pair"); CL.dice.classList.remove("dice--win"); return single; } else { CL.dice.classList.remove(["dice--pair"], ["dice--win"]); const pointMax = Math.max.apply(null, CL.rollResults); return pointMax; } } } class SERVICEWORKER { constructor() { this.path = '/sw.js'; this.scope = '/'; this.swRegistered = false; this.swControlled = false; } registerSW() { navigator.serviceWorker.register(SW.path, { scope: SW.scope }).then(function (sw) { console.log('Registration succeeded. Scope is ' + sw.scope); }).catch(function (error) { console.log('Registration failed with ' + error); }); } checkRegistration() { navigator.serviceWorker.getRegistration().then(function (reg) { if (reg) { console.log('Service worker registration confirmed'); SW.swRegistered = true; } else { console.log('No service worker registered'); SW.swRegistered = false; } SW.registered.textContent = "Registered: " + SW.swRegistered; }).catch(function (error) { console.log('Check registration promise error: ' + error); }); } unregisterSW() { navigator.serviceWorker.register(SW.path, { scope: SW.scope }).then(function (sw) { sw.unregister().then(function () { console.log('Service Worker unregistered'); }); }).catch(function (error) { console.log('Registration failed with ' + error); }); } } let SW = new SERVICEWORKER(); let Cache = new CACHE(); let CL = new CEELO(); document.addEventListener("DOMContentLoaded", function (event) { if ('serviceWorker' in navigator) { SW.registered = document.querySelector(".sw-status__registered"); SW.controlled = document.querySelector(".sw-status__controlled"); SW.register = document.querySelector(".sw-status__register"); SW.unregister = document.querySelector(".sw-status__unregister"); SW.checkRegistration(); SW.controlled.textContent = "Controlled: " + navigator.serviceWorker.controller; SW.register.addEventListener('click', function () { SW.registerSW(); }, false); SW.unregister.addEventListener('click', function () { SW.unregisterSW(); }, false); } else { alert("Service Workers not supported!"); } Cache.cache_button = document.querySelector(".cache-status__cache"); Cache.install_button = document.querySelector(".cache-status__install-button"); Cache.checkCache(); Cache.install_button.addEventListener('click', function () { if (!Cache.cached) { Cache.installCache(); } else { Cache.deleteCache(); } }, false); CL.setPoint = document.querySelector(".set-point"); CL.dice = document.querySelector(".dice"); CL.roll = document.querySelector(".roll"); CL.createDice(); CL.allDice = document.getElementsByClassName("dice__die"); CL.roll.addEventListener('click', function () { CL.rollResults = CL.rollDice(); CL.matches = CL.findMatches(); CL.setPoint.textContent = CL.determineResults(); }, false); });</script> <link rel="manifest" href="/manifest.json"> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.5,minimum-scale=1"> <meta name="theme-color" content="#c90808"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-title" content="Firebrand"> <meta name="apple-mobile-web-app-status-bar-style" content="black"> <link rel="apple-touch-icon-precomposed" sizes="192x192" href="images/icons/icon192.png"> </head> <body> <section class="sw-status message"> <h2>Service Worker Status</h2> <div class="sw-status__registered">Registered:</div> <div class="sw-status__controlled">Controlled:</div> <ul> <li><a class="sw-status__register" href="#">Register Service Worker</a></li> <li><a class="sw-status__unregister" href="#">Unregister Service Worker</a></li> </ul> </section> <section class="cache-status message"> <h2>Cache Status</h2> <ul> <li><a class="cache-status__install-button" href="#">Cache</a></li> </ul> </section> <section class="cee-lo message"> <h2>Cee-lo</h2> <div class="dice"></div> <br> <a class="roll" href="#">Roll</a> <div class="set-point">SP</div> </section> </body> </html> 
