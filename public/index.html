<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <title>Welcome to Firebrand</title> <link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAlUlEQVR42rXSwQmAMBQD0I7SkbpRV+gcHchzT47Qq0pAY0o/n4IKwUvzLMGQQzjuXE9I17sO6QjPvINC5gFEyh8CRH4BqgLMEqAFIh4wfj0pwsyAjALLAARZAGKMzzW3vY8I3mm6gQIIYYZlG0Cc9X2glOKsb48IoLXG29hlAlmWByJhwQSIVAVkxCnQUdR0RP4NEzoBfBT42XTc3E4AAAAASUVORK5CYII="> <style>body{font-family:Roboto,Arial,sans-serif;background:#ECEFF1 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAGUlEQVR42mI4c+bMfyBgYAQRZ8+e/Q8QYAB1SAzF+qrpogAAAABJRU5ErkJggg==");color:rgba(0,0,0,0.87);margin:0;box-sizing:border-box;border-top:5px solid #e50303}body.sw-controlled{border-color:green}a{color:#039be5}.message{width:300px;max-width:80%;margin:40px auto;box-shadow:0 1px 3px 0 rgba(0,0,0,0.2),0 1px 1px 0 rgba(0,0,0,0.14),0 2px 1px -1px rgba(0,0,0,0.12);border-radius:2px;background:white;padding:16px 24px;text-align:center}.message h2{font-size:22px;font-weight:500;text-align:center;margin:0 0 16px}.message p{font-weight:300;line-height:150%}.message ul{list-style:none;margin:16px 0 0;padding:0;text-align:center}.message li a{display:inline-block;margin-bottom:5px;padding:8px;text-transform:uppercase;text-decoration:none;font-weight:500;background:#e50303;color:white;border:1px solid #039be5;border-radius:3px;font-size:14px;line-height:18spx;box-shadow:0 2px 5px 0 rgba(0,0,0,0.26);min-width:120px;height:16px;overflow:hidden}.message .cache-status__install--false,.message .sw-status__registered--false{background:#e50303}.message .cache-status__install--true,.message .sw-status__registered--true{background:green}body{font-family:sans-serif}.dice{border:2px dashed #ab9d9d;padding:5px;border-radius:2px;display:inline-block;margin:0 0 5px}.dice--pair{background-color:red}.dice--win{background-color:blue}.dice__die{display:inline-block;background:silver;margin:0 5px 5px 0;padding:5px;width:15px;font-weight:bold;border-radius:5px;text-align:center}.dice__die:last-child{margin-right:0}.roll{display:inline-block;margin:0 0 5px 0;padding:5px;text-decoration:none;color:white;background:#e50303;border-radius:2px}</style> <script>class CACHE { constructor() { this.currentCache = "v1"; this.cached = false; this.install_button = ""; } check() { caches.match('/').then(function (resp) { if (resp) { Cache.install_button.classList.add("cache-status__install--true"); Cache.install_button.textContent = "Cached"; Cache.cached = true; } else { Cache.install_button.classList.add("cache-status__install--false"); Cache.install_button.textContent = "Uncached"; Cache.cached = false; } }); } install() { const filesToCache = ['/']; caches.open(Cache.currentCache).then(function (cache) { cache.addAll(filesToCache).then(function () { location.reload(); }); }); } delete() { caches.open(Cache.currentCache).then(function (cache) { cache.delete('/').then(function (response) { location.reload(); }); }).catch(function (error) { console.log('Cache delete failed' + error); }); } clean() { const cacheWhitelist = [currentCache]; caches.keys().then(function (keyList) { return Promise.all(keyList.map(function (key) { if (cacheWhitelist.indexOf(key) === -1) { return caches.delete(key); } })); }); } fetch() { event.respondWith(caches.match(event.request).then(function (resp) { if (resp) console.log("SW: Resource loaded from cache"); return resp || fetch(event.request).then(function (response) { console.log("SW: Requested resource not yet cached, caching now"); return caches.open(currentCache).then(function (cache) { cache.put(event.request, response.clone()); return response; }); }); })); } } class CEELO { constructor() { this.rollResults = ""; this.matches = ""; this.potentialPoints = ""; this.dice = ""; this.setPoint = ""; this.roll = ""; this.allDice = ""; } createDice(amount = 3) { for (let index = 0; index < amount; index++) { const dieDiv = document.createElement("div"); dieDiv.classList.add("dice__die"); dieDiv.classList.add("dice__die-" + (index + 1)); const placeholderContent = document.createTextNode("6"); dieDiv.appendChild(placeholderContent); CL.dice.appendChild(dieDiv); } } rollDice() { console.log("rolling dice"); let rollResults = []; Array.prototype.forEach.call(CL.allDice, function (die) { const rollResult = Math.floor(Math.random() * 6 + 1); die.textContent = rollResult; rollResults.push(rollResult); }); return rollResults; } findMatches() { let sortedRolls = CL.rollResults.slice().sort(); CL.potentialPoints = sortedRolls.slice(); let matches = []; for (let i = 0; i < CL.rollResults.length - 1; i++) { if (sortedRolls[i] == sortedRolls[i + 1]) { matches.push(sortedRolls[i]); CL.potentialPoints.splice(i, 2); } } return matches; } determineResults() { const rolledDoubles = CL.matches[0]; const rolledTriples = CL.matches[1]; if (rolledTriples) { CL.dice.classList.add("dice--win"); } else if (rolledDoubles) { const single = CL.potentialPoints[0]; CL.dice.classList.add("dice--pair"); CL.dice.classList.remove("dice--win"); return single; } else { CL.dice.classList.remove(["dice--pair"], ["dice--win"]); const pointMax = Math.max.apply(null, CL.rollResults); return pointMax; } } } class SERVICEWORKER { constructor() { this.path = '/sw.js'; this.scope = '/'; this.registered = false; this.register_button = ""; } checkRegistration() { navigator.serviceWorker.getRegistration().then(function (reg) { if (reg) { SW.register_button.classList.add("sw-status__registered--true"); SW.register_button.textContent = "Registered"; SW.registered = true; } else { SW.register_button.classList.add("sw-status__registered--false"); SW.register_button.textContent = "Unregistered"; SW.registered = false; } }).catch(function (error) { console.log('Check registration promise error: ' + error); }); } checkControl() { if (navigator.serviceWorker.controller) { document.querySelector("body").classList.add("sw-controlled"); } } register() { navigator.serviceWorker.register(SW.path, { scope: SW.scope }).then(function (sw) { location.reload(); }).catch(function (error) { console.log('Registration failed with ' + error); }); } unregister() { navigator.serviceWorker.register(SW.path, { scope: SW.scope }).then(function (sw) { sw.unregister().then(function () { location.reload(); }); }).catch(function (error) { console.log('Registration failed with ' + error); }); } } let SW = new SERVICEWORKER(); let Cache = new CACHE(); let CL = new CEELO(); document.addEventListener("DOMContentLoaded", function (event) { if ('serviceWorker' in navigator) { SW.register_button = document.querySelector(".sw-status__register-button"); SW.checkRegistration(); SW.checkControl(); SW.register_button.addEventListener('click', function () { if (!SW.registered) SW.register();else SW.unregister(); }, false); } else { alert("Service Workers not supported!"); } Cache.install_button = document.querySelector(".cache-status__install-button"); Cache.check(); Cache.install_button.addEventListener('click', function () { if (!Cache.cached) Cache.install();else Cache.delete(); }, false); CL.setPoint = document.querySelector(".set-point"); CL.dice = document.querySelector(".dice"); CL.roll = document.querySelector(".roll"); CL.createDice(); CL.allDice = document.getElementsByClassName("dice__die"); CL.roll.addEventListener('click', function () { CL.rollResults = CL.rollDice(); CL.matches = CL.findMatches(); CL.setPoint.textContent = CL.determineResults(); }, false); });</script> <link rel="manifest" href="/manifest.json"> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.5,minimum-scale=1"> <meta name="theme-color" content="#c90808"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-title" content="Firebrand"> <meta name="apple-mobile-web-app-status-bar-style" content="black"> <link rel="apple-touch-icon-precomposed" sizes="192x192" href="images/icons/icon192.png"> </head> <body> <section class="sw-status message"> <h2>Service Worker Status</h2> <ul> <li><a class="sw-status__register-button" href="#"></a></li> </ul> </section> <section class="cache-status message"> <h2>Cache Status</h2> <ul> <li><a class="cache-status__install-button" href="#"></a></li> </ul> </section> <section class="cee-lo message"> <h2>Cee-lo</h2> <div class="dice"></div> <br> <ul> <li><a class="roll" href="#">Roll</a></li> </ul> <div class="set-point">SP</div> </section> </body> </html> 
